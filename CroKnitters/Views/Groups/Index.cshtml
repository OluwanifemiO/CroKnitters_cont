@model List<GroupsViewModel>
@{
    ViewData["Title"] = "Groups";
}

<div class="container mx-auto">

    <div class="p-3">

        <a asp-controller="Groups" asp-action="CreateGroup" class="w-auto justify-center rounded-md bg-indigo-600 m-3 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-2">Create Group</a>

        <a asp-controller="Groups" asp-action="MoreGroups" class="w-auto justify-center rounded-md bg-indigo-600 m-3 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-2">See more Groups</a>
        
        <a asp-controller="Chats" asp-action="Index" class="w-auto justify-center rounded-md bg-indigo-600 m-3 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-2">Back to Private Chats</a>

        <div class="rounded-lg border text-center shadow-xl h-auto m-5 bg-white" style="width: 500px;">

            @if (TempData["error"] != null)
            {
                <p class="text-danger">
                    @TempData["error"]
                </p>
            }

            <h2 class="text-2xl text-center p-2 font-bold"> My Groups</h2>
            <hr />
            @if (Model.Count < 1)
            {
                <div class="m-2">
                    <p class="text-2xl"> OOPS! Looks like you are not in any group. Here are the available groups you can join. </p>
                </div>

                <!--List of all groups-->
                <div class="sm:w-full sm:max-w-sm p-4">
                    <ul role="list" class="divide-y divide-grey-900">

                        @foreach (var group in ViewBag.groups)
                        {
                            <!--if something goes wrong-->
                            @if (group == null)
                            {
                                <p>Something went wrong, no groups to show.</p>
                            }
                            else
                            {
                                <li class="flex justify-between w-auto gap-x-6 py-5">
                                    <div class="min-w-0 flex-auto">
                                        <h4 class="text-xl font-semibold leading-6 text-gray-900">@group.GroupName</h4>
                                        <h3 class="mt-1 text-xs leading-5 text-gray-500">@group.Description</h3>
                                        <p class="mt-1 text-xs leading-5 text-gray-500">created @group.CreationDate</p>
                                        <p class="mt-1 text-xs leading-5 text-gray-500">@group.GroupUsers.Count member(s)</p>

                                        <a asp-controller="Groups" asp-action="JoinGroup" asp-route-id="@group.GroupId" class="btn btn-primary">Join Group</a>
                                    </div>
                                </li>
                                <hr />
                            }
                        }

                    </ul>
                </div>
            }
            else
            {
                <div class="sm:w-full sm:max-w-sm p-4">
                    <ul role="list" class="divide-y divide-grey-900">

                        @foreach (var group in Model)
                        {
                            <li class="flex justify-between w-auto gap-x-6 py-5">

                                <div class="min-w-0 flex-auto">
                                    <h4 class="text-xl font-semibold leading-6 text-gray-900">@group.GroupName</h4>
                                    <h3 class="mt-1 text-xs leading-5 text-gray-500">@group.Description</h3>
                                    <p class="mt-1 text-xs leading-5 text-gray-500">created @group.CreationDate</p>
                                    <p class="mt-1 text-xs leading-5 text-gray-500">@group.MemberCount member(s)</p>

                                    <a class="btn btn-primary bg-primary m-1" type="button" asp-controller="Groups" asp-action="GetChat" asp-route-id="@group.GroupId">Enter Chat</a>
                                </div>

                            </li>
                            <hr />
                        }
                    </ul>
                </div>
            }
        </div>
    </div>
</div>

@section scripts{
    <script src="~/js/signalr.min.js"></script>
    <script src="https://www.unpkg.com/axios@1.6.8/dist/axios.min.js"></script>

    <script>

        var connection = new signalR.HubConnectionBuilder().withUrl("/hub/groupChatHub").build();

        //start the connection and get the connection id
        connection.start().then(function () {

            console.log("Connection started");

        }).catch(function (err) {
            return console.log(err.toString())
        })

    </script>
}